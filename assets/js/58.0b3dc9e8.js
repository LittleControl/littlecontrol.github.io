(window.webpackJsonp=window.webpackJsonp||[]).push([[58],{410:function(t,s,n){"use strict";n.r(s);var a=n(25),e=Object(a.a)({},(function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[n("h1",{attrs:{id:"对js中的事件循环的简单理解"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#对js中的事件循环的简单理解"}},[t._v("#")]),t._v(" 对JS中的事件循环的简单理解")]),t._v(" "),n("p",[t._v("首先明确一个概念,JS是一门单线程非堵塞的的语言.对于浏览器引擎与Node引擎实现事件循环的方式有些许区别.这里只以浏览器环境为例.")]),t._v(" "),n("h2",{attrs:{id:"执行栈与事件循环"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#执行栈与事件循环"}},[t._v("#")]),t._v(" 执行栈与事件循环")]),t._v(" "),n("p",[t._v("假设所有的JS代码都是同步的,那么一般的执行顺序就是从上往下,调用栈也是如此.可以简单的来说有一个大的流水线,如果没有什么调皮捣蛋的东西(一些异步函数,比如setTimeout)的话,他们都是一样的进栈出栈,就是简单的函数调用栈.但是一旦有了setTimeout这样的异步函数,即无法立即获得结果的函数的时候,就会把这些坏孩子拿出来同意放进一个小黑屋里,而那个大的流水线还继续进行.什么时候把哪些孩子们放出来呢,等其他人都工作完了,都走完了,也就是流水线上空了以后,就会准备把那些孩子们放出来.但是一下子都放出来可不妥,门也没有这么大呀,那咋办嘛,只好把这些孩子按照年龄来分类.16岁一下的为小孩子,16以上的为大孩子,大孩子因为要让着小孩子,但是也不能委屈了大孩子,所以每次小孩子可以一次出去,而每次大孩子只能出去一个.当孩子们出去一次的时候,就意味着流水线上不为空了,那么小黑屋里的其他孩子们就要等待下一次流水线的空闲.需要注意的是,每一次一定都是小孩子先出去,而且所有的小孩子都会出去,而每次大孩子只能出去一个,而且还是在小孩子之后.这样每次开门放孩子出来就是一次事件循环.")]),t._v(" "),n("h2",{attrs:{id:"微任务-micro-task-和宏任务-macro-task"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#微任务-micro-task-和宏任务-macro-task"}},[t._v("#")]),t._v(" 微任务(micro task)和宏任务(macro task)")]),t._v(" "),n("p",[t._v("这里的微任务就是上面所说的小孩子,而宏任务就是大孩子."),n("br"),t._v("\n常见的微任务:")]),t._v(" "),n("ul",[n("li",[t._v("Promise")]),t._v(" "),n("li",[t._v("MutaionObserver")]),t._v(" "),n("li",[t._v("process.nextTick(Node)")])]),t._v(" "),n("p",[t._v("常见的宏任务")]),t._v(" "),n("ul",[n("li",[t._v("setTimeout")]),t._v(" "),n("li",[t._v("setInterval")]),t._v(" "),n("li",[t._v("setImmediate(非标准特性,不建议使用)")]),t._v(" "),n("li",[t._v("I/O(Node)")])]),t._v(" "),n("h2",{attrs:{id:"代码测试"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#代码测试"}},[t._v("#")]),t._v(" 代码测试")]),t._v(" "),n("div",{staticClass:"language-JavaScript extra-class"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//setTimeout2")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("setTimeout")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" console"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nconsole"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" intervalId "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("setInterval")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" console"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//setTimeout2")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("setTimeout")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    console"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//promise1")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Promise")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("resolve")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        console"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("resolve")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//promise 1.1")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("then")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" console"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("6")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//promise 1.2")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("then")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            console"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("7")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("clearInterval")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("intervalId"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//promise2")]),t._v("\nPromise"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("resolve")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//promise 2.1")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("then")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" console"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("8")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//promise 2.2")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("then")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" console"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("9")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nconsole"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 2 10 8 9 1 3 4 5 6 7")]),t._v("\n")])])]),n("p",[t._v("简单来解析一下执行过程,代码从上往下开始执行")]),t._v(" "),n("ol",[n("li",[n("code",[t._v("setTimeout(() => console.log(1), 0)")]),t._v(",异步代码,放入宏任务队列中")]),t._v(" "),n("li",[n("code",[t._v("console.log(2)")]),t._v(",同步代码立即执行,输出2")]),t._v(" "),n("li",[n("code",[t._v("const intervalId = setInterval(() => console.log(3), 0)")]),t._v(",异步代码,放入宏任务队列")]),t._v(" "),n("li",[n("code",[t._v("setTimeout(function () {...")]),t._v(", 异步代码,放入宏任务队列")]),t._v(" "),n("li",[n("code",[t._v("Promise.resolve()..")]),t._v(",异步代码,放入微任务队列中,需要注意的是,这里是把两个then函数都会放入")]),t._v(" "),n("li",[n("code",[t._v("console.log(10)")]),t._v(",同步代码,立即执行,输出10")])]),t._v(" "),n("p",[t._v("到这里为止,主线程上代码以全部执行完成,处于空闲,然后就需要执行任务队列中的,我们来看一下这时候任务队列中的已有的东西"),n("br"),t._v("\n微任务队列中: promise2.1 promise 2.2"),n("br"),t._v("\n宏任务队列: setTimeout1 setInterval setTimeout2"),n("br"),t._v("\n然后下面进入事件轮询")]),t._v(" "),n("ol",[n("li",[t._v("清空微任务的事件")]),t._v(" "),n("li",[t._v("完成宏任务队列中的第一个事件")]),t._v(" "),n("li",[t._v("当主线程空闲时回到1")])]),t._v(" "),n("p",[t._v("具体过程,第一次事件循环")]),t._v(" "),n("ul",[n("li",[t._v("执行promise2.1 输出8")]),t._v(" "),n("li",[t._v("执行promise2.2 输出9")]),t._v(" "),n("li",[t._v("执行setTimeout1 输出1")])]),t._v(" "),n("p",[t._v("第二次事件循环")]),t._v(" "),n("ul",[n("li",[t._v("微任务队列为空,不做操作")]),t._v(" "),n("li",[t._v("执行setInterval,输出3,同时将下一个setInterval加入宏任务队列")])]),t._v(" "),n("p",[t._v("第三次事件循环")]),t._v(" "),n("ul",[n("li",[t._v("微任务队列为空,不做操作")]),t._v(" "),n("li",[t._v("执行setTimeout2,输出4 5 ,同时将promise1.1 和 promise1.2 加入微任务队列")])]),t._v(" "),n("p",[t._v("第四次事件循环")]),t._v(" "),n("ul",[n("li",[t._v("清空微任务队列,首先执行promise1.1,输出 6")]),t._v(" "),n("li",[t._v("再执行promise1.2,输出 7, 同时清楚定时器,此时位于宏任务队列中的定时器已被清楚")]),t._v(" "),n("li",[t._v("由于promise1.2已经清除了定时器,所以此时宏任务队列为空")])]),t._v(" "),n("p",[t._v("至此,任务队列也已经全部清空,程序终止.")])])}),[],!1,null,null,null);s.default=e.exports}}]);