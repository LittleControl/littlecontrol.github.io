(window.webpackJsonp=window.webpackJsonp||[]).push([[64],{415:function(t,s,a){"use strict";a.r(s);var e=a(25),r=Object(e.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"android-rom的解包和打包"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#android-rom的解包和打包"}},[t._v("#")]),t._v(" Android ROM的解包和打包")]),t._v(" "),a("h2",{attrs:{id:"环境要求"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#环境要求"}},[t._v("#")]),t._v(" 环境要求")]),t._v(" "),a("ul",[a("li",[t._v("基于Linux,因为win下比较麻烦")]),t._v(" "),a("li",[t._v("刷机包为卡刷包")])]),t._v(" "),a("h2",{attrs:{id:"步骤"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#步骤"}},[t._v("#")]),t._v(" 步骤")]),t._v(" "),a("p",[t._v("解压卡刷包一般得到如下文件")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("firmware-update")])]),t._v(" "),a("li",[a("code",[t._v("META-INF")])]),t._v(" "),a("li",[a("code",[t._v("boot.img")])]),t._v(" "),a("li",[a("code",[t._v("system.new.dat.br")])]),t._v(" "),a("li",[a("code",[t._v("system.patch.dat")])]),t._v(" "),a("li",[a("code",[t._v("system.transfer.list")])]),t._v(" "),a("li",[a("code",[t._v("vendor.new.dat.br")])]),t._v(" "),a("li",[a("code",[t._v("vendor.patch.dat")])]),t._v(" "),a("li",[a("code",[t._v("vendor.transfer.list")])])]),t._v(" "),a("p",[t._v("这里我们以system为例,vendor和system是一样的.因为boot.img较为复杂,这里不作了解和阐述."),a("br"),t._v("\n需要注意的,对于"),a("code",[t._v("system.new.dat.br 和 system.patch.dat 和 system.transfer.list")]),t._v(",其实都是三位一体的(大概),反正你知道这三个是一个东西出来的就好了,后面解包打包的时候会用到.")]),t._v(" "),a("h2",{attrs:{id:"解包"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#解包"}},[t._v("#")]),t._v(" 解包")]),t._v(" "),a("h3",{attrs:{id:"br转dat"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#br转dat"}},[t._v("#")]),t._v(" br转dat")]),t._v(" "),a("p",[t._v("br格式的文件相当于是dat文件又进行了一次压缩,所以要先进行这一步操作"),a("br"),t._v("\n不同的发行版有各自的软件包管理系统,使用这个软件仓库就可以直接安装"),a("code",[t._v("brotli")]),a("br"),t._v("\n类似,像我一样的ArchLinux,可以直接"),a("code",[t._v("pacman -S brotli")]),a("br"),t._v("\nDebian应该可以直接"),a("code",[t._v("apt install brotli")]),a("br"),t._v("\n安装好"),a("code",[t._v("brotli")]),t._v("之后运行命令,"),a("code",[t._v("brotli -d system.new.dat.br")]),t._v(",这布操作需要的时间可能会有点久,耐心等待即可."),a("br"),t._v("\n然后我们就得到了"),a("code",[t._v("system.new.dat")])]),t._v(" "),a("h3",{attrs:{id:"dat转img"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#dat转img"}},[t._v("#")]),t._v(" dat转img")]),t._v(" "),a("p",[t._v("img格式的文件才是我们最后需要的文件格式.这一步我们需要将dat文件转为img文件"),a("br"),t._v("\n需要用到python,和GitHub上的一个项目"),a("code",[t._v("sdat2img")]),t._v(":"),a("a",{attrs:{href:"https://github.com/xpirt/sdat2img",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://github.com/xpirt/sdat2img"),a("OutboundLink")],1)]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("git")]),t._v(" clone https://github.com/xpirt/sdat2img\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" sdat2img\npython sdat2img.py system.transfer.list system.new.dat system.img\n")])])]),a("p",[t._v("需要注意的是,这一步用到了list文件和dat文件,最后一个参数是生成文件名,patch好像暂时不用用到.")]),t._v(" "),a("h3",{attrs:{id:"挂载img"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#挂载img"}},[t._v("#")]),t._v(" 挂载img")]),t._v(" "),a("p",[t._v("前面我们已经得到system.img,这一步我们需要将其挂载到磁盘上,然后就可以方便的访问里面的文件了")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("mkdir")]),t._v(" -p /mnt/system\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("mount")]),t._v(" -o loop system.img /mnt/system\n")])])]),a("p",[t._v("然后就直接可以去"),a("code",[t._v("/mnt/system")]),t._v("目录下进行修改了,因为我也不是很懂安卓,所以也不能做过多的阐述.我一般也就是精简一些系统内置的App或者加入一些想要增加的app,仅仅只是对内置应用修改的话,直接操作"),a("code",[t._v("/app")]),t._v("目录和"),a("code",[t._v("/priv-app")]),t._v("目录就可以了.需要注意文件的权限问题,参考修改之前的文件权限就可以了")]),t._v(" "),a("h2",{attrs:{id:"打包"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#打包"}},[t._v("#")]),t._v(" 打包")]),t._v(" "),a("h3",{attrs:{id:"生成img文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#生成img文件"}},[t._v("#")]),t._v(" 生成img文件")]),t._v(" "),a("p",[t._v("这里需要用到make_ext4fs这个工具包,项目链接:"),a("a",{attrs:{href:"https://github.com/superr/make_ext4fs",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://github.com/superr/make_ext4fs"),a("OutboundLink")],1)]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("git")]),t._v(" clone https://github.com/superr/make_ext4fs.git\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" make_ext4fs\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("make")]),t._v("\n")])])]),a("p",[t._v("以上就编译完成了这个make_ext4fs,然后执行一下命令\n"),a("code",[t._v("make_ext4fs -T 0 -l 1024M -a system system.new.img /mnt/system")])]),t._v(" "),a("ul",[a("li",[t._v("-T 代表对镜像中的unix文件时间戳进行设置，这里设置为0，表示1970-1-1")]),t._v(" "),a("li",[t._v("-l 表示目标镜像的大小。如果不懂得写多少可以使用df -h命令查看挂载点/mnt/system的总大小，然后取整数（512M,1024M,2048M…），比如查得挂载点空间大- 小是992M,你就得写1024M")]),t._v(" "),a("li",[t._v("-a 指定目标img文件在Android中的挂载点")]),t._v(" "),a("li",[t._v("system.new.img 表示生成的镜像")]),t._v(" "),a("li",[t._v("/mnt/system/ 表示源目录")])]),t._v(" "),a("p",[t._v("这时候就可以卸载system分区了,"),a("code",[t._v("umount /mnt/system")])]),t._v(" "),a("h3",{attrs:{id:"img转dat"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#img转dat"}},[t._v("#")]),t._v(" img转dat")]),t._v(" "),a("p",[t._v("用到的工具img2sdat"),a("a",{attrs:{href:"https://github.com/xpirt/img2sdat",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://github.com/xpirt/img2sdat"),a("OutboundLink")],1)]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("git")]),t._v(" clone https://github.com/xpirt/img2sdat.git\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" img2sdat\n./img2sdat.py system.img -o ./ -v "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),t._v("\n")])])]),a("p",[t._v("这样就会在当前目录下生成"),a("code",[t._v("system.new.bat")]),t._v(", "),a("code",[t._v("system.patch.dat")]),t._v(", "),a("code",[t._v("system.transfer.list")]),t._v(",更多用法请查看原项目链接")]),t._v(" "),a("h3",{attrs:{id:"dat转br"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#dat转br"}},[t._v("#")]),t._v(" dat转br")]),t._v(" "),a("p",[a("code",[t._v("brotli -0 system.new.bat")])]),t._v(" "),a("h2",{attrs:{id:"更新压缩包"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#更新压缩包"}},[t._v("#")]),t._v(" 更新压缩包")]),t._v(" "),a("p",[t._v("这时候我们已经得到了新的"),a("code",[t._v("system.new.bat.br")]),t._v(", "),a("code",[t._v("system.patch.dat")]),t._v(", "),a("code",[t._v("system.transfer.list")]),t._v(",替换它们原来的压缩包就可以了"),a("br"),t._v(" "),a("code",[t._v("zip yourROM.zip system.new.dat.br system.transfer.list system.patch.dat")])]),t._v(" "),a("h2",{attrs:{id:"这次system分区的修改就结束了-vendor分区类似"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#这次system分区的修改就结束了-vendor分区类似"}},[t._v("#")]),t._v(" 这次system分区的修改就结束了,vendor分区类似")]),t._v(" "),a("p",[t._v("可以将更新后的卡刷包刷机试试,注意备份数据,因为随时可能会翻车")])])}),[],!1,null,null,null);s.default=r.exports}}]);